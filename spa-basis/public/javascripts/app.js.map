{"version":3,"file":"public\\javascripts\\app.js","sources":["app/application.js","app/initialize.js","app/lib/appcache.js","app/lib/connectivity.js","app/lib/location.js","app/lib/notifications.js","app/lib/persistence.js","app/lib/places.js","app/lib/router.js","app/lib/view_helper.js","app/models/check_in.js","app/models/collection.js","app/views/check_in_view.js","app/views/history_view.js","app/views/home_view.js","app/views/templates/check_in.hbs","app/views/templates/check_ins.hbs","app/views/templates/history.hbs","app/views/templates/home.hbs","app/views/templates/places.hbs","app/views/view.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxEA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/IA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjGA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtBA;;A","sourcesContent":["require('lib/appcache');\n\n// L'appli principale.  Reste super basique à ce stade : on a un seul\n// écran donc pas de routes spéciales pour plein de trucs, et on\n// connecte juste la racine à la Home View.\nvar Application = {\n  initialize: function() {\n    var HomeView = require('views/home_view');\n    var Router = require('lib/router');\n    \n    this.homeView = new HomeView();\n    this.router = new Router();\n    if ('function' === typeof Object.freeze)\n      Object.freeze(this);\n  }\n};\n\nmodule.exports = Application;\n","// L'initialiseur applicatif.  Se contente de faire deux choses :\n//\n// 1. Instancier l'application JS et l'initialiser\n// 2. Activer la gestion des routes Backbone (même si on ne s'en\n//    sert pas particulièrement ici)\n\nvar application = require('application');\n\n$(function() {\n  moment.lang('fr');\n  application.initialize();\n  Backbone.history.start();\n});\n","if (!window.applicationCache)\r\n\treturn;\r\n\r\nwindow.applicationCache.addEventListener('updateready', function (){\r\n\t$('#reloadPrompt').modal({ show: true });\r\n});\r\n","/* jshint browser: true */\n/* global $, Backbone */\n\nexports.isOnline = function() { return true; };\n\nif ('onLine' in navigator) {\n\texports.isOnline = function isOnline() { return navigator.onLine; };\n\n\t$(window).on('online offline', checkStatus);\n\tcheckStatus();\n}\n\nfunction checkStatus() {\n\tBackbone.Mediator.publish(navigator.onLine ? 'connectivity:online' : 'connectivity:offline');\n}\n","// Encapsulation du service de géolocalisation.  Va envoyer\n// un message si le client ne prend pas en charge l'API de\n// géolocalisation W3C.\n\n// Si cette API n'est pas exploitable pour une raison quelconque\n// (ex. connexion à un DSLAM mal équipé/configuré, genre au fin\n// fond de la Creuse…), on peut travailler avec cette appli en\n// plaçant cette variable `$FAKE` à `true`, ce qui renverra\n// \"en dur\" les coordonnées du siège de Delicious Insights ;-)\nvar $FAKE = false;\n\n// Voici la méthode-clé de vérification de la géolocalisation.\n// C'est la seule méthode exposée par le module.  L'API W3C tente\n// en général d'exploiter une précision maximale (par exemple en\n// interpolant les données issues de points d'accès Wi-Fi proches).\n// Le callback est appelé soit avec une latitude et une longitude\n// (en cas de succès) soit avec un message d'erreur.\n//\n// Performance : la géoloc navigateur par des moyens non-GPS\n// (ex. interpolation Wi-Fi, requêtage DSLAM…) peut prendre pas\n// mal de temps (4-6s pendant mes tests).\nfunction getCurrentLocation(callback) {\n  if (!_.isFunction(callback))\n    throw 'Missing or invalid callback';\n  if ($FAKE) {\n    callback(48.88268482, 2.32229512);\n  } else {\n    navigator.geolocation.getCurrentPosition(function(position) {\n      callback(position.coords.latitude, position.coords.longitude);\n    }, function(msg) {\n      if (!_.isString(msg)) msg = 'Geolocation failure';\n      callback(msg);\n    });\n  }\n}\n\nif (navigator.geolocation) {\n  module.exports = { getCurrentLocation: getCurrentLocation };\n} else {\n  alert(\"Ah flute, pas de geoloc dans le navigateur, snif…\");\n}\n","/* global io */\r\nvar store = require('lib/persistence');\r\n\r\nvar userName = sessionStorage.userName || $.trim(prompt(\"Votre nom d'utilisateur\"));\r\n\r\nif (userName) {\r\n\tsessionStorage.userName = userName;\r\n\t/*sessionStorage.set(userName, 'userName');*/\r\n} else {\r\n\tuserName= 'Anonymous' + _.random(1, 100);\r\n}\r\n\r\nvar socket = io.connect();\r\nsocket.on('checkin', function(checkIn) {\r\n\tstore.addCheckIn(checkIn);\r\n});\r\n\r\nexports.userName = userName;\r\n","/* jshint browser:true */\r\n/* global Backbone, _, $, Lawnchair */\r\n\r\nvar CheckInsCollection = require('models/collection');\r\nvar cnxSvc = require('lib/connectivity');\r\n\r\nvar collection = new CheckInsCollection();\r\nvar localStore = new Lawnchair({ name: 'checkins' }, $.noop);\r\n\r\nfunction addCheckIn (checkIn) {\r\n\tcheckIn.set('key', Date.now());\r\n\tif (collection.findWhere(_.pick(checkIn, 'key', 'userName')))\r\n\t\treturn;\r\n\r\n\tcollection['id' in checkIn ? 'add' : 'create'](checkIn);\r\n}\r\n\r\nfunction getCheckIns() {\r\n\treturn collection.toJSON();\r\n}\r\n\r\nfunction initialLoad() {\r\n\tlocalStore.all(function(checkIns){\r\n\t\tcollection.reset(checkIns);\r\n\t});\r\n}\r\n\r\nfunction syncPending() {\r\n\tif (!cnxSvc.isOnline())\r\n\t\treturn;\r\n\r\n\tvar pendings = collection.filter(function(model) { return model.isNew(); });\r\n\tif (pendings.length) {\r\n\t\tcollection.on('sync', accountForSync);\r\n\t\t_.invoke(pendings, 'save');\r\n\t} else {\r\n\t\tcollection.fetch({ reset: true });\r\n\t}\r\n\r\n\tfunction accountForSync(model) {\r\n\t\tpendings = _.without(pendings, model);\r\n\t\tif (pendings.length)\r\n\t\t\treturn;\r\n\r\n\t\tcollection.off('sync', accountForSync);\r\n\t\tcollection.fetch({ reset: true });\r\n\t}\r\n}\r\n\r\ninitialLoad();\r\nsyncPending();\r\nBackbone.Mediator.subscribe('connectivity:online', syncPending);\r\n\r\ncollection.on('reset', function () {\r\n\tlocalStore.nuke(function() {\r\n\t\tlocalStore.batch(collection.toJSON());\r\n\t});\r\n\tBackbone.Mediator.publish('checkins:reset');\r\n});\r\n\r\ncollection.on('add', function (model) {\r\n\tlocalStore.save(model.toJSON());\r\n\tBackbone.Mediator.publish('checkins:new', model.toJSON());\r\n});\r\n\r\ncollection.on('sync', function(model) {\r\n\tif (model instanceof collection.model)\r\n\t\tlocalStore.save(model.toJSON());\r\n});\r\n\r\nexports.addCheckIn = addCheckIn;\r\nexports.getCheckIns = getCheckIns;\r\n","/* jshint browser:true */\n/* global _, document, google, $ */\n\n// Encapsulation de la bibliothèque Places au sein de la Google Maps v3 JS API.\n// La formation ne s'occupe pas des détails de ce module, qui est annexe au\n// sujet.\n\n// Clé API dédiée à l'atelier.  Permet 1K req/jour, pensez à enregistrer\n// votre propre appli et clé sur http://code.google.com/apis/console\nvar JSGURUV3_API_KEY = 'AIzaSyCoiEjsdXfD5roowpX5jN3cwImV1TgGzIs';\n\n// On s'intéresse uniquement à certains types de POI.\nvar POI_TYPES = ['bakery', 'bar', 'cafe', 'food', 'meal_takeaway', 'restaurant'];\n\n// On filtre les résultats sur un certain rayon (en mètres) autour des géocoords\n// initiales.\nvar RADIUS = 500;\n\n// On limite aussi le resultset à un certain nombre de POI, sinon ça devient\n// vite le souk à scanner.\nvar MAX_PLACES = 12;\n\n// On fait attention à la connectivité pour éviter les appels en offline\n// et rafraîchir automatiquement en cas d'online à nouveau.\nvar placesService, distanceService, cnxSvc = require('lib/connectivity');\n\n// Si cette API n'est pas exploitable pour une raison quelconque\n// (ex. on est offline), on peut travailler avec cette appli en\n// plaçant cette variable `$FAKE` à `true`, ce qui renverra\n// \"en dur\" des POI autour du siège de Delicious Insights ;-)\nvar $FAKE = false;\n\n// Fonction interne d'initialisation de l'API par chargement\n// asynchrone de la lib depuis chez Google et exploitation d'un\n// callback.\nfunction initializePlacesAPI() {\n  if (placesService || !cnxSvc.isOnline()) return;\n  var script = document.createElement('script');\n  script.src = 'http://maps.googleapis.com/maps/api/js?key=' + JSGURUV3_API_KEY +\n    '&libraries=places&sensor=true&callback=makePlacesReady';\n\n  window.makePlacesReady = function() {\n    delete window.makePlacesReady;\n    var div = document.createElement('div');\n    placesService = new google.maps.places.PlacesService(div);\n    distanceService = new google.maps.DistanceMatrixService();\n  };\n\n  $('script:first').after(script);\n}\n\n// Recherche des POI pertinents près d'une position donnée.  La position peut\n// $etre donnée soit en deux arguments (latitude et longitue) soit en tant que\n// `google.maps.LatLng`, donc un seul argument.  Dans les deux cas, l'argument\n// final *doit* être une fonction de rappel, qui sera appelée avec un tableau de\n// hashes représentant les POI.\n//\n// Performance : durant les tests, c'est assez rapide--pas plus d’1s.\nfunction lookupPlaces(lat, lng, callback) {\n  if (!placesService && !$FAKE) {\n    console.log('Place search service isn’t ready yet! Deferring 1s…');\n    _.delay(lookupPlaces, 1000, lat, lng, callback);\n    return;\n  }\n\n  // On joue offline ? Pas grave, on renvoie des trucs de test histoire de…\n  if ($FAKE) {\n    callback([\n      { name: 'Le Mont Liban', vicinity: '42 Boulevard Batignolles', distance: 65, duration: 49 },\n      { name: 'La Raymondine', vicinity: '42 Boulevard Batignolles', distance: 65, duration: 49 },\n      { name: 'Batignolles Express', vicinity: '32 Rue Batignolles', distance: 80, duration: 60 },\n      { name: 'Les Batignolles', vicinity: '31 Boulevard Batignolles', distance: 99, duration: 68 },\n      { name: 'AGD', vicinity: '36 Boulevard Batignolles', distance: 99, duration: 68 },\n      { name: 'Le Paris Rome', vicinity: '60 Boulevard Batignolles', distance: 103, duration: 88 },\n      { name: 'Picard Surgelés', vicinity: '37 Avenue Clichy', distance: 108, duration: 92 },\n      { name: 'La Boutique de Camille', vicinity: '33 Boulevard Batignolles', distance: 126, duration: 115 },\n      { name: 'Fédération de la Boucherie', vicinity: '23 Rue Clapeyron', distance: 127, duration: 116 }\n    ]);\n    return;\n  }\n\n  if (!cnxSvc.isOnline()) {\n    callback([]);\n    return;\n  }\n\n  // Traitements de la signature variable pour l'appel à cette fonction.\n  callback = arguments[arguments.length - 1];\n  if (!_.isFunction(callback))\n    throw 'Missing or invalid callback';\n  var latLng;\n  if (lat instanceof google.maps.LatLng)\n    latLng = lat;\n  else if (_.isUndefined(lng))\n    throw 'Invalid call: requires either a LatLng or a latitude plus a longitude';\n  else\n    latLng = new google.maps.LatLng(lat, lng);\n\n  // Lancement de la recherche\n  placesService.search({\n    location: latLng,\n    rankBy:   google.maps.places.RankBy.DISTANCE,\n    types:    POI_TYPES\n  }, function(result, status) {\n    if (google.maps.places.PlacesServiceStatus.OK !== status) {\n      callback([]);\n      return;\n    }\n\n    // Bon, maintenant on chope la distance pour chaque point (car Google Places\n    // n'a pas eu la bonne idée de le filer, tsk tsk).  Heureusement, l'API concernée\n    // est super rapide (sans doute vu qu'elle n'a aucune I/O à faire côté Google).\n    var dests = $.map(result, function(p) { return p.geometry.location; });\n    distanceService.getDistanceMatrix({\n      origins: [latLng],\n      destinations: dests,\n      travelMode: google.maps.TravelMode.WALKING\n    }, function(distances) {\n      for (var index = 0, l = result.length; index < l; ++index) {\n        var item = result[index], dist = distances.rows[0].elements[index];\n        result[index] = {\n          id:       item.id,\n          icon:     item.icon,\n          name:     item.name,\n          vicinity: item.vicinity,\n          distance: dist.distance.value,\n          duration: dist.duration.value\n        };\n      }\n      result = _.filter(result, function(r) { return r.distance <= RADIUS; });\n      result = _.sortBy(result, function(r) { return r.distance; });\n      callback(result.slice(0, MAX_PLACES));\n    });\n  });\n}\n\ninitializePlacesAPI();\nBackbone.Mediator.subscribe('connectivity:online', initializePlacesAPI);\n\nmodule.exports = {\n  lookupPlaces: lookupPlaces,\n  poiTypes: POI_TYPES\n};\n","// Le routeur le plus basique du monde…\n\nvar application = require('application');\n\nmodule.exports = Backbone.Router.extend({\n  routes: {\n    '': 'home'\n  },\n\n  home: function() {\n    $('body').html(application.homeView.render().el);\n  }\n});\n","// Ce module est un emplacement dédié pour tous nos helpers Handlebars.\n\n// Petit helper formattant un nombre de secondes avec un niveau\n// d'arrondi plus parlant (tel quel sous la minute, en minutes sinon).\nHandlebars.registerHelper('seconds_to_minutes', function(secs) {\n  return secs < 50 ? secs + 's' : Math.round(secs / 60) + 'mn';\n});","/* global Backbone */\nvar cnxSync = require('lib/connectivity');\n\nmodule.exports = Backbone.Model.extend({\n\tsync: function sync(method, model, options) {\n\t\tif (!cnxSync.isOnline())\n\t\t\treturn;\n\t\t\n\t\treturn Backbone.sync(method, model, options);\n\t}\n});\n","/* global Backbone */\n\nmodule.exports = Backbone.Collection.extend({\n\tcomparator: function compareCheckIns (c1, c2) {\n\t\treturn +c2.get('key') - +c1.get('key');\n\t},\n\n\tmodel: require('models/check_in'),\n\n\turl: '/checkins'\n});\n","/* global $, _, moment */\r\n\r\nvar View = require('./view');\r\nvar locSvc = require('lib/location');\r\nvar poiSvc = require('lib/places');\r\nvar userName = require('lib/notifications').userName;\r\nvar store = require('lib/persistence');\r\n\r\nmodule.exports = View.extend({\r\n\tcurrentPlace: null,\r\n\r\n\tevents: {\r\n\t\t'click header button': 'fetchPlaces',\r\n\t\t'click #places li': 'selectPlace',\r\n\t\t'submit': 'checkIn'\r\n\t},\r\n\r\n\tlistTemplate: require('./templates/places'),\r\n\r\n\tplaces: [],\r\n\r\n\tsubscriptions: {\r\n\t\t'connectivity:online': 'fetchPlaces'\r\n\t},\r\n\t\r\n\ttemplate: require('./templates/check_in'),\r\n\r\n\tafterRender: function afterCIRender() {\r\n\t\tthis.fetchPlaces();\r\n\t},\r\n\r\n\tcheckIn: function checkIn (e) {\r\n\t\te.preventDefault();\r\n\t\tif (!this.currentPlace)\r\n\t\t\treturn;\r\n\r\n\t\tvar placeId = this.currentPlace.attr('data-place-id');\r\n\t\tvar place = _.findWhere(this.places, { id: placeId });\r\n\t\tstore.addCheckIn({\r\n\t\t\tplaceId: place.id,\r\n\t\t\tname: place.name,\r\n\t\t\ticon: place.icon,\r\n\t\t\tvicinity: place.vicinity,\r\n\t\t\tstamp: moment().format('HH:mm'),\r\n\t\t\tuserName: userName,\r\n\t\t\tcomment: this.$('#comment').val()\r\n\t\t});\r\n\t\tthis.updateUI(false);\r\n\t},\r\n\r\n\tfetchPlaces: function fetchPlaces () {\r\n\t\tvar that = this;\r\n\t\tthis.places = [];\r\n\t\tthis.renderPlaces();\r\n\t\tthis.updateUI(false);\r\n\t\tlocSvc.getCurrentLocation(function (lat, lng) {\r\n\t\t\tthat.$('#geoloc').text(lat.toFixed(7) + ' / ' + lng.toFixed(7));\r\n\t\t\tpoiSvc.lookupPlaces(lat, lng, function (pois) {\r\n\t\t\t\tthat.places = pois;\r\n\t\t\t\tthat.renderPlaces();\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tgetRenderData: function getCIRenderData () {\r\n\t\treturn {\r\n\t\t\tplaceList: this.listTemplate({ places: this.places })\r\n\t\t};\r\n\t},\r\n\r\n\trenderPlaces: function renderPlaces () {\r\n\t\tthis.$('#places').html(this.getRenderData().placeList);\r\n\t},\r\n\r\n\tselectPlace: function selectPlace (e) {\r\n\t\tvar active = this.$('#places li.active'), current = $(e.currentTarget);\r\n\t\tif (active[0] === current[0])\r\n\t\t\treturn;\r\n\r\n\t\tactive.removeClass('active');\r\n\t\tthis.currentPlace = current.addClass('active');\r\n\t\tthis.updateUI(true);\r\n\t},\r\n\r\n\tupdateUI: function updateUI(enabled) {\r\n\t\tthis.submitter = this.submitter || this.$('button[type=\"submit\"]');\r\n\t\tif (enabled) {\r\n\t\t\tthis.submitter.attr('disabled', false);\r\n\t\t} else {\r\n\t\t\tthis.submitter.attr('disabled', true);\r\n\t\t\tif (this.currentPlace)\r\n\t\t\t\tthis.currentPlace.removeClass('active');\r\n\t\t\tthis.currentPlace = null;\r\n\t\t\tthis.$('#comment').val('');\r\n\t\t}\r\n\t}\r\n});\r\n","/* global _ */\r\n\r\nvar View = require('./view');\r\nvar store = require('lib/persistence');\r\n\r\nmodule.exports = View.extend({\r\n\tlistTemplate : require('./templates/check_ins'),\r\n\tsubscriptions: {\r\n\t\t'checkins:new': 'insertCheckIn',\r\n\t\t'checkins:reset': 'render'\r\n\t},\r\n\ttemplate: require('./templates/history'),\r\n\r\n\tgetRenderData: function getHistoryRenderData() {\r\n\t\treturn { checkIns: this.listTemplate(store.getCheckIns()) };\r\n\t},\r\n\r\n\tinsertCheckIn: function insertCheckIn(checkIn) {\r\n\t\tcheckIn.extraClass = 'new';\r\n\t\tvar html = this.listTemplate([checkIn]);\r\n\t\tthis.$('#history').prepend(html);\r\n\t\tvar that = this;\r\n\t\t_.defer(function() {\r\n\t\t\tthat.$('#history li.new').removeClass('new');\r\n\t\t});\r\n\t}\r\n});\r\n","/* global moment */\nvar View = require('./view');\nvar userName = require('lib/notifications').userName;\nvar CheckInView = require('./check_in_view');\nvar HistoryView = require('./history_view');\nvar cnxSvc = require('lib/connectivity');\n\nmodule.exports = View.extend({\n\tsubscriptions: {\n\t\t'connectivity:online': 'syncMarker',\n\t\t'connectivity:offline': 'syncMarker',\n\t},\n\n\ttemplate: require('./templates/home'),\n\n\tafterRender: function afterHomeRender() {\n\t\tthis.syncMarker();\n\t\tthis.startClock();\n\t\tnew CheckInView({ el: this.$('#checkInUI') }).render();\n\t\tnew HistoryView({ el: this.$('#historyUI') }).render();\n\t},\n\n\tgetRenderData: function getHomeRenderData() {\n\t\treturn {\n\t\t\tnow : moment().format('dddd D MMMM YYYY HH:mm:ss'),\n\t\t\tuserName: userName\n\t\t};\n\t},\n\n\tstartClock: function startClock() {\n\t\tthis.clock = this.clock || this.$('#ticker');\n\t\tvar that = this;\n\t\tsetInterval(function() {\n\t\t\tthat.clock.text(that.getRenderData().now);\n\t\t}, 1000);\n\t},\n\n\tsyncMarker: function syncMarker() {\n\t\tthis.marker = this.marker || this.$('#onlineMarker').tooltip({ placement: 'bottom' });\n\t\tthis.marker[cnxSvc.isOnline() ? 'show' : 'hide']('fast');\n\t}\n});\n","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\";\n\n\n  buffer += \"<header class=\\\"row\\\">\\r\\n  <p id=\\\"geoloc\\\" class=\\\"lead pull-left\\\">Je suis…</p>\\r\\n  <button type=\\\"button\\\" class=\\\"btn btn-info pull-right\\\">Chercher des endroits à proximité</button>\\r\\n</header>\\r\\n \\r\\n<ul id=\\\"places\\\" class=\\\"row list-unstyled\\\">\";\n  if (stack1 = helpers.placeList) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.placeList; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</ul>\\r\\n \\r\\n<form id=\\\"submission\\\" class=\\\"row form-inline\\\" role=\\\"form\\\">\\r\\n  <div class=\\\"col-sm-9 col-xs-12\\\">\\r\\n    <input type=\\\"text\\\" placeholder=\\\"Votre commentaire ici…\\\" id=\\\"comment\\\" class=\\\"form-control\\\">\\r\\n  </div>\\r\\n  <div class=\\\"col-sm-3 col-xs-12\\\">\\r\\n    <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Check-In&nbsp;!</button>\\r\\n  </div>\\r\\n</form>\";\n  return buffer;\n  });","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var stack1, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\r\\n\t<li class=\\\"\";\n  if (stack1 = helpers.extraClass) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.extraClass; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n\t\t<div class=\\\"icon\\\">\\r\\n\t\t\t<img src=\\\"\";\n  if (stack1 = helpers.icon) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.icon; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" alt=\\\"\\\" class=\\\"img-responsive\\\">\\r\\n\t\t</div>\\r\\n\t\t<div class=\\\"details\\\">\\r\\n\t\t\t<strong title=\\\"\";\n  if (stack1 = helpers.name) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.name; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\";\n  if (stack1 = helpers.name) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.name; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</strong>\\r\\n\t\t\t<time>\";\n  if (stack1 = helpers.stamp) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.stamp; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</time>\\r\\n\t\t\t<address>\";\n  if (stack1 = helpers.vicinity) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.vicinity; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</address>\\r\\n\t\t\t<cite>\";\n  if (stack1 = helpers.userName) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.userName; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</cite>\\r\\n\t\t\t\";\n  stack1 = helpers['if'].call(depth0, depth0.comment, {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\t\t</div>\\r\\n\t</li>\\r\\n\";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\r\\n\t\t\t\t<q>\";\n  if (stack1 = helpers.comment) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.comment; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</q>\\r\\n\t\t\t\";\n  return buffer;\n  }\n\n  stack1 = helpers.each.call(depth0, depth0, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  });","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\";\n\n\n  buffer += \"<ul id=\\\"history\\\" class=\\\"list-unstyled\\\">\";\n  if (stack1 = helpers.checkIns) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.checkIns; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</ul>\";\n  return buffer;\n  });","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"container\\\">\\n  <div class=\\\"navbar navbar-default navbar-fixed-top\\\" role=\\\"navigation\\\">\\n    <div class=\\\"navbar-header\\\">\\n      <button type=\\\"button\\\" class=\\\"navbar-toggle\\\" data-toggle=\\\"collapse\\\" data-target=\\\".navbar-ex1-collapse\\\">\\n        <span class=\\\"sr-only\\\">Basculer nav.</span>\\n        <span class=\\\"icon-bar\\\"></span>\\n        <span class=\\\"icon-bar\\\"></span>\\n        <span class=\\\"icon-bar\\\"></span>\\n      </button>\\n      <a class=\\\"navbar-brand\\\" href=\\\"#\\\">JS Total 21 février 2014</a>\\n    </div>\\n\\n    <div class=\\\"collapse navbar-collapse navbar-ex1-collapse\\\">\\n      <ul class=\\\"nav navbar-nav\\\">\\n        <li>\\n          <p class=\\\"navbar-text\\\">\\n            <i id=\\\"onlineMarker\\\" class=\\\"glyphicon glyphicon-signal\\\" title=\\\"Vous êtes connecté(e)\\\"></i>\\n            <span>\";\n  if (stack1 = helpers.userName) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.userName; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n          </p>\\n      </ul>\\n      <ul class=\\\"nav navbar-nav navbar-right\\\">\\n        <li>\\n          <p class=\\\"navbar-text\\\">\\n            <i class=\\\"glyphicon glyphicon-time\\\"></i>\\n            <span id=\\\"ticker\\\">\";\n  if (stack1 = helpers.now) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.now; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n            &nbsp;\\n          </p>\\n        </li>\\n      </ul>\\n    </div>\\n  </div>\\n\\n  <div class=\\\"row\\\">\\n    <div class=\\\"col-md-8\\\"><div id=\\\"checkInUI\\\" class=\\\"well\\\"></div></div>\\n    <div class=\\\"col-md-4\\\"><div id=\\\"historyUI\\\" class=\\\"well\\\"></div></div>\\n  </div>\\n\\n  <div class=\\\"modal fade\\\" id=\\\"reloadPrompt\\\">\\n    <div class=\\\"modal-dialog\\\">\\n      <div class=\\\"modal-content\\\">\\n        <div class=\\\"modal-header\\\">\\n          <button class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\">×</button>\\n          <h4 class=\\\"modal-title\\\">Nouvelle version disponible !</h4>\\n        </div>\\n        <div class=\\\"modal-body\\\">\\n          <p>Une nouvelle version de cette application est disponible.</p>\\n          <p>Souhaitez-vous la charger dès maintenant ?</p>\\n        </div>\\n        <div class=\\\"modal-footer\\\">\\n          <a href=\\\"\\\" class=\\\"btn btn-primary\\\">Mais carrément !</a>\\n          <button type=\\\"button\\\" class=\\\"btn btn-default\\\" data-dismiss=\\\"modal\\\">Nan, pas la peine</button>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</div>\\n\";\n  return buffer;\n  });","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var stack1, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, options;\n  buffer += \"\\r\\n\t<li class=\\\"col-md-4 col-sm-6\\\" data-place-id=\\\"\";\n  if (stack1 = helpers.id) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.id; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n\t\t<div class=\\\"icon\\\">\\r\\n\t\t\t<img src=\\\"\";\n  if (stack1 = helpers.icon) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.icon; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" alt=\\\"\\\" class=\\\"img-responsive\\\">\\r\\n\t\t</div>\\r\\n\t\t<div class=\\\"details\\\">\\r\\n\t\t\t<strong title=\\\"\";\n  if (stack1 = helpers.name) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.name; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\";\n  if (stack1 = helpers.name) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.name; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</strong>\\r\\n\t\t\t<address>\";\n  if (stack1 = helpers.vicinity) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.vicinity; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</address>\\r\\n\t\t\t<small>(à \";\n  if (stack1 = helpers.distance) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.distance; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"m, soit \";\n  options = {hash:{},data:data};\n  buffer += escapeExpression(((stack1 = helpers.seconds_to_minutes || depth0.seconds_to_minutes),stack1 ? stack1.call(depth0, depth0.duration, options) : helperMissing.call(depth0, \"seconds_to_minutes\", depth0.duration, options)))\n    + \" à pied)</small>\\r\\n\t\t</div>\\r\\n\t</li>\\r\\n\";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  \n  return \"\\r\\n\t<li class=\\\"searching\\\">\\r\\n\t\t<img src=\\\"/images/spinner.gif\\\" alt=\\\"\\\" class=\\\"spinner\\\">\\r\\n\t\tRecherche en cours...\\r\\n\t</li>\\r\\n\";\n  }\n\n  stack1 = helpers.each.call(depth0, depth0.places, {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  });","require('lib/view_helper');\n\n// Classe de base pour toutes les vues.  Presque pile\n// celle de brunch.io (on a juste ajouté le _.defer pour\n// régler automatiquement toute une catégorie de bugs,\n// et initialisé la langue de Moment.js).\nmodule.exports = Backbone.View.extend({\n  initialize: function() {\n    _.bindAll(this, 'template', 'getRenderData', 'render', 'afterRender');\n  },\n\n  template: function() {},\n  getRenderData: function() {},\n\n  render: function() {\n    this.$el.html(this.template(this.getRenderData()));\n    _.defer(this.afterRender);\n    return this;\n  },\n\n  afterRender: function() {}\n});\n"]}